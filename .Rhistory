```{r}
library(stm)
library (igraph)
library (stmCorrViz)
library(readxl)
GGcommunicationdataset_mw_062723 <- read_excel("C:/Users/User/Dropbox/Documents backedup/text analysis/communication analysis/data/GGcommunicationdataset mw 062723.xlsx")
View(GGcommunicationdataset_mw_062723)
library(dplyr)
GGcommunicationdata_mw_060723$lag_communication <- dplyr::lag(GGcommunicationdata_mw_060723$text)
processed <- textProcessor(GGcommunicationdataset_mw_060723$text, metadata = GGcommunicationdataset_mw_060723)
processed <- textProcessor(GGcommunicationdataset_mw_062723$text, metadata = GGcommunicationdataset_mw_062723)
out <- prepDocuments(processed$documents, processed$vocab, processed$meta)
docs <- out$documents
vocab <- out$vocab
meta <- out$meta
```{r}
plotRemoved(processed$documents, lower.thresh = seq(1,200, by=100))
plotRemoved(processed$documents, lower.thresh = seq(1,200, by=100))
communicationfit <- stm(out$documents, out$vocab, K=5, prevalence = ~treatment, data = out$meta, max.em.its=75, init.type = "Spectral", seed = 8458150)
plot(communicationfit, type = "summary", xlim = c(0,1))
```
plot(communicationfit, type = "labels", topics = c(3,4))
plot(communicationfit, type = "labels", topics = c(3,4))
plot(communicationfit, type = "hist")
plot(communicationfit, type = "perspectives", topics = c(2,4))
communicationSelect <- selectModel(out$documents, out$vocab, K=10, prevalence = ~cooperation+round, max.em.its=30, data = meta, runs=20, seed=8458159)
plotModels(communicationSelect)
topicQuality(model = communicationfit, documents = docs)
selectModel1 <- communicationSelect$runout [[1]]
labelTopicSel <- labelTopics(poliblogPrevFit, c(3,20))
out$meta$rating <- as.factor(out$meta$rating)
plot(prep, covariate="treatment", topics=c(3,4), model=communicationfit, method = "difference", cov.value1 = "0", cov.value2 = "2", xlab =  "complete information ... competing hydrology", main = "communication and treatment", xlim = c(-0.5,.5), labeltype = "custom", custom.labels = c("strategy_building","longterm_perspecive"))
prep <- estimateEffect(1:5 ~ treatment, communicationfit, meta=out$meta,
prep <- estimateEffect(1:5 ~ treatment, communicationfit, meta=out$meta,
uncertainty="Global")
plot(prep, covariate="treatment", topics=c(3,4), model=communicationfit, method = "difference", cov.value1 = "0", cov.value2 = "2", xlab =  "complete information ... competing hydrology", main = "communication and treatment", xlim = c(-0.5,.5), labeltype = "custom", custom.labels = c("strategy_building","longterm_perspecive"))
plot(prep, "round", method="continuous", topics=3, model=z, printlegend=FALSE, xaxt="n",
xlab="round (1-10)")
labelTopicSel <- labelTopics(poliblogPrevFit, c(1,3))
plotModels(communicationSelect)
selectModel1 <- communicationSelect$runout [[3]]
plotQuote(thoughts3, width=40, main="Topic 3")
topicQuality(model = communicationSelect, documents = docs)
topicQuality(model = communicationfit, documents = docs)
labelTopicsSel <- labelTopics(communicationfit, c(1,3,4))
print(sageLabels(communicationfit))
thoughts3 <- findThoughts(communicationfit, texts=shortdoc, n=3, topics=3)$docs[[1]]
thoughts3 <- findThoughts(communicationfit, texts=text, n=3, topics=3)$docs[[1]]
selectModel1 <- communicationSelect$runout [[3]]
out$meta$rating <- as.factor(out$meta$rating)
prep <- estimateEffect(1:5 ~ treatment, communicationfit, meta=out$meta, uncertainty="Global")
plot(prep, covariate="treatment", topics=c(3,4), model=communicationfit, method = "difference", cov.value1 = "0", cov.value2 = "2", xlab =  "complete information ... competing hydrology", main = "communication and treatment", xlim = c(-0.5,.5), labeltype = "custom", custom.labels = c("strategy_building","longterm_perspecive"))
plot(prep, covariate="cooperation", topics = c(1,2,3,4,5), model=communicationfit, method = "difference", cov.value1 = "0", cov.value2 = "1", xlab = "less cooperation ... more cooperation", main = "The effects of communication on cooperation", xlim = c(-0.5,.5), labeltype = "custom", custom.labels = c("strategy1", "strategy2", "strategy3", "strategy4", "strategy5"))
plot(prep, covariate="cooperation", topics = c(1,2,3,4,5), model=communicationfit, method = "difference", cov.value1 = "0", cov.value2 = "1", xlab = "less cooperation ... more cooperation", main = "The effects of communication on cooperation", xlim = c(-0.5,.5), labeltype = "custom", custom.labels = c("strategy1", "strategy2", "strategy3", "strategy4", "strategy5"))
communicationfit2 <- stm(out$documents, out$vocab, K=5, prevalence = ~cooperation+round, data = out$meta, max.em.its=75, init.type = "Spectral", seed = 8458150)
plot(communicationfit2, type = "summary", xlim = c(0,1))
plot(communicationfit2, type = "labels", topics = c(3,4))
plot(communicationfit2, type = "hist")
plot(communicationfit, type = "perspectives", topics = c(1,4))
communicationSelect <- selectModel(out$documents, out$vocab, K=10, prevalence = ~cooperation+round, max.em.its=30, data = meta, runs=20, seed=8458159)
plotModels(communicationSelect)
topicQuality(model = communicationfit, documents = docs)
topicQuality(model = communicationfit2, documents = docs)
```{r}
selectModel1 <- communicationSelect$runout [[1]]
prep <- estimateEffect(1:5 ~ cooperation+round, communicationfit2, meta=out$meta, uncertainty="Global")
prep <- estimateEffect(1:5 ~ treatment, communicationfit, meta=out$meta, uncertainty="Global")
prep1 <- estimateEffect(1:5 ~ cooperation+round, communicationfit2, meta=out$meta, uncertainty="Global")
plot(prep1, covariate="cooperation", topics = c(1,2,3,4,5), model=communicationfit, method = "difference", cov.value1 = "0", cov.value2 = "1", xlab = "less cooperation ... more cooperation", main = "The effects of communication on cooperation", xlim = c(-0.5,.5), labeltype = "custom", custom.labels = c("strategy1", "strategy2", "strategy3", "strategy4", "strategy5"))
plot(prep1, "round", method="continuous", topics=3, model=z, printlegend=FALSE, xaxt="n",
xlab="round (1-10)")
mod.out.corr <- topicCorr(communicationfit2)
plot(mod.out.corr)
plot(prep1, "round", method="continuous", topics=3, model=z, printlegend=FALSE, xaxt="n",
xlab="round (1-10)")
mod.out.corr <- topicCorr(communicationfit2)
plot(mod.out.corr)
